<!DOCTYPE HTML>

<html>
    <head>
        <meta charset="UTF-8" />
        <link rel="stylesheet" type="text/css" href="css/default.css" />
        <script src="./js/dracula/jquery-1.4.2.min.js"></script>
        <!--  The Raphael JavaScript library for vector graphics display  -->
        <script src="./js/kineticJS/kinetic-v4.0.1.js"></script>

        <!--  The Raphael JavaScript library for vector graphics display  -->
        <script src="./js/dracula/raphael-min.js"></script>
        <!--  Dracula  -->
        <!--  An extension of Raphael for connecting shapes -->
        <script type="text/javascript" src="./js/dracula/dracula_graffle.js"></script>
        <!--  Graphs  -->
        <script src="./js/dracula/dracula_graph.js"></script>
        <script src="./js/dracula/dracula_algorithms.js"></script>
        <script src="./js/boardGraph.js"></script>
        <script src="./js/terrain.js"></script>
        <script src="./js/boardSetup.js"></script>
        <script>
            var stage;
            var selectionLayer = new Kinetic.Layer();
            var boardGraph;
            
            function writeMessage(messageLayer, message) {
                var context = messageLayer.getContext();
                messageLayer.clear();
                context.font = "18pt Calibri";
                context.fillStyle = "black";
                context.align = "right";
                context.fillText(message, stage.getWidth()-180, 25);
            }

            window.onload = function() {
                stage = new Kinetic.Stage({
                    container: "container",
                    width: 1370,
                    height: 600
                });
                var messageLayer = new Kinetic.Layer();
                var layer = new Kinetic.Layer();

                var terrainDatabases = new Hasl.TerrainDatabases();
                var boardName = 'test';
                var boardY = new Hasl.Board(boardName, 6, 3, terrainDatabases.getDatabase(boardName));
                boardGraph = boardY.getBoardGraph(); //new Hasl.BoardGraph();
                drawBoard(boardGraph, layer, messageLayer, true);

                stage.add(layer);
                stage.add(selectionLayer);
                stage.add(messageLayer);

                stage.setScale(0.75,0.75);
                stage.draw();
                
                $("#graph").hide();
            };
        
            function renderGraph()
            {
                $("#graph").show();
                $("#showGraph").hide();
            
                var width = $(document).width();
                var height = $(document).height() - 100;

                var render = function(r, n) {
                    /* the Raphael set is obligatory, containing all you want to display */
                    var set = r.set().push(
                    /* custom objects go here */
                    r.rect(n.point[0]-30, n.point[1]-13, 60, 44).attr({"fill": "#feb", r : "12px", "stroke-width" : n.distance == 0 ? "3px" : "1px" })).push(
                    r.text(n.point[0], n.point[1] + 10, (n.label || n.id) + "\n(" + (n.distance == undefined ? "Infinity" : n.distance) + ")"));
                    return set;
                };
    
                /* layout the graph using the Spring layout implementation */
                var layouter = new Graph.Layout.Spring(boardGraph.graph);
    
                /* draw the graph using the RaphaelJS draw implementation */

                /* calculating the shortest paths via Bellman Ford */
                //    bellman_ford(g, g.nodes["Berlin"]);
    
                /* calculating the shortest paths via Dijkstra */
                dijkstra(boardGraph.graph, boardGraph.graph.nodes["A1"]);
    
                /* calculating the shortest paths via Floyd-Warshall */
                //floyd_warshall(g, g.nodes["Berlin"]);


                /* colourising the shortest paths and setting labels */
                for(e in boardGraph.graph.edges) {
                    if(boardGraph.graph.edges[e].target.predecessor === boardGraph.graph.edges[e].source || boardGraph.graph.edges[e].source.predecessor === boardGraph.graph.edges[e].target) {
                        boardGraph.graph.edges[e].style.stroke = "#bfa";
                        boardGraph.graph.edges[e].style.fill = "#56f";
                    } else {
                        boardGraph.graph.edges[e].style.stroke = "#aaa";
                    }
                }
    
                var renderer = new Graph.Renderer.Raphael('canvas', boardGraph.graph, width, height);

                redraw = function() {
                    layouter.layout();
                    renderer.draw();
                };
            };

        </script>
    </head>
    <body>
        <div id="container"></div>
        <div id="debugGraph">
            <button id="showGraph" onclick="renderGraph();">Show graph</button><br>
            <div id="graph">
                Graph look'n ugly? Hit <button id="redraw" onclick="redraw();">redraw</button>!<br>
                <div id="canvas"></div>
            </div>
        </div>
    </body>
</html>